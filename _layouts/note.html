---
layout: single
---

{% assign relative_path = page.path | remove_first: '_notes/' %}
{% assign path_parts = relative_path | split: '/' %}
{% assign category_slug = path_parts[0] %}
{% assign subcategory_slug = nil %}
{% if path_parts.size > 2 %}
  {% assign subcategory_slug = path_parts[1] %}
{% endif %}
{% assign base_fragment = '_notes/' | append: category_slug | append: '/' %}
{% if subcategory_slug %}
  {% assign base_fragment = base_fragment | append: subcategory_slug | append: '/' %}
{% endif %}
{% assign candidate_notes = site.notes | where_exp: 'item', 'item.path contains base_fragment' %}
{% if subcategory_slug %}
  {% assign notes_in_group = candidate_notes | sort: 'title' %}
{% else %}
  {% assign direct_notes = "" | split: "" %}
  {% for item in candidate_notes %}
    {% assign trimmed_path = item.path | remove_first: base_fragment %}
    {% unless trimmed_path contains '/' %}
      {% assign direct_notes = direct_notes | push: item %}
    {% endunless %}
  {% endfor %}
  {% assign notes_in_group = direct_notes | sort: 'title' %}
{% endif %}
{% assign prev_note = nil %}
{% assign next_note = nil %}
{% assign previous_item = nil %}
{% assign found_self = false %}
{% for item in notes_in_group %}
  {% if found_self %}
    {% assign next_note = item %}
    {% break %}
  {% endif %}
  {% if item.path == page.path %}
    {% assign prev_note = previous_item %}
    {% assign found_self = true %}
  {% endif %}
  {% assign previous_item = item %}
{% endfor %}

{{ content }}

{% if prev_note or next_note %}
<nav class="note-pagination">
  {% if prev_note %}
  <a class="btn btn--inverse note-pagination__link note-pagination__link--prev" href="{{ prev_note.url }}">
    &larr; {{ prev_note.title | default: prev_note.data.title }}
  </a>
  {% endif %}
  {% if next_note %}
  <a class="btn btn--inverse note-pagination__link note-pagination__link--next" href="{{ next_note.url }}">
    {{ next_note.title | default: next_note.data.title }} &rarr;
  </a>
  {% endif %}
</nav>
{% endif %}
